{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "test",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/anaconda3/envs/moelora/bin/deepspeed",
            // "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            // "python": "/root/anaconda3/envs/moelora/bin/python3.9",
            "console": "integratedTerminal",
            "args": [
                "/root/lhy/MOELoRA-peft/run_mlora.py",
                "debug_arg_ds_train.json"
            ],
            "env": {
                "MASTER_PORT": "23456",
                "RANK": "0",
                "WORLD_SIZE": "8",
                "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7"
            },
            "justMyCode": false
        },
        {
            "name": "debug",
            "type": "debugpy",
            "request": "launch",
            // "program": "/root/anaconda3/envs/moelora/bin/deepspeed",
            "program": "run_mlora.py",
            "python": "/root/anaconda3/envs/moelora/bin/python3.9",
            "console": "integratedTerminal",
            "args": [
                // "/root/lhy/MOELoRA-peft/run_mlora.py",
                "debug.json"
            ],
            "env": {
                // "MASTER_PORT": "23456",
                // "RANK": "0",
                // "WORLD_SIZE": "1",
                // // "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7"
                "CUDA_VISIBLE_DEVICES": "0",
                "WANDB_DISABLED": "true"
            },
            "justMyCode": false
        },
        {
            "name": "debug_predict",
            "type": "debugpy",
            "request": "launch",
            // "program": "/root/anaconda3/envs/moelora/bin/deepspeed",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "python": "/root/anaconda3/envs/moelora/bin/python3.9",
            "console": "integratedTerminal",
            "args": [
                // "/root/lhy/MOELoRA-peft/run_mlora.py",
                "arg_ds_predict.json"
            ],
            "env": {
                // "MASTER_PORT": "23456",
                // "RANK": "0",
                // "WORLD_SIZE": "1",
                // // "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7"
                "CUDA_VISIBLE_DEVICES": "0",
                "WANDB_DISABLED": "true"
            },
            "justMyCode": false
        },

        {
            "name": "Python: DeepSpeed",
            "type": "debugpy",
            // "python": "/root/anaconda3/envs/moelora/bin/python3.9",
            "request": "launch",
            // "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "program": "/root/anaconda3/envs/moelora/bin/deepspeed",
            "console": "integratedTerminal",
            "args": [
                // "--num_gpus=8",
                // "--master_port=23456",
                "/root/lhy/MOELoRA-peft/run_mlora.py",
                "--deepspeed", "src/ds.config",
                "--do_train",
                "--train_file", "datasets/train.json",
                "--cache_dir", "datasets",
                "--prompt_column", "input",
                "--response_column", "target",
                "--overwrite_cache",
                "--model_name_or_path", "/root/lhy/model/bloom-1b4-zh",
                "--output_dir", "saved/moelora",
                "--overwrite_output_dir",
                "--max_source_length", "1024",
                "--max_target_length", "196",
                "--per_device_train_batch_size", "8",
                "--per_device_eval_batch_size", "8",
                "--gradient_accumulation_steps", "2",
                "--max_steps", "10000",
                "--logging_steps", "100",
                "--save_steps", "500",
                "--learning_rate", "0.0002",
                "--lora_rank", "16",
                "--trainable", "query_key_value,dense_h_to_4h,dense_4h_to_h,dense",
                "--modules_to_save", "null",
                "--lora_dropout", "0.1",
                "--fp16",
                "--lora_name", "moelora",
                "--expert_num", "8",
                "--remove_unused_columns", "false",
                "--task_embedding_dim", "32"
            ],
            "env": {
                "MASTER_PORT": "23456", // 示例端口号，根据需要更改
                "RANK": "0",  // 指定当前进程的 RANK 值
                "WORLD_SIZE": "4", // 指定分布式环境中的进程总数
                "CUDA_VISIBLE_DEVICES": "0,1,2,3"
            }
        },
        {
            "name": "Python: Distributed Training",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/anaconda3/envs/moelora/lib/python3.9/site-packages/torch/distributed/launch.py",
            // "program": "/root/anaconda3/envs/moelora/bin/deepspeed",
            "console": "integratedTerminal",
            "args": [
                "/root/lhy/MOELoRA-peft/run_mlora.py",
                // "arg_train.json"
                // "--deepspeed", "src/ds.config",
                "--do_train",
                "--train_file", "datasets/train.json",
                "--cache_dir", "datasets",
                "--prompt_column", "input",
                "--response_column", "target",
                "--overwrite_cache",
                "--model_name_or_path", "/root/lhy/model/bloom-1b4-zh",
                "--output_dir", "saved/moelora",
                "--overwrite_output_dir",
                "--max_source_length", "1024",
                "--max_target_length", "196",
                "--per_device_train_batch_size", "8",
                "--per_device_eval_batch_size", "8",
                "--gradient_accumulation_steps", "1",
                "--max_steps", "10000",
                "--logging_steps", "100",
                "--save_steps", "500",
                "--learning_rate", "0.0002",
                "--lora_rank", "16",
                "--trainable", "query_key_value,dense_h_to_4h,dense_4h_to_h,dense",
                "--modules_to_save", "null",
                "--lora_dropout", "0.1",
                "--fp16",
                "--lora_name", "moelora",
                "--expert_num", "8",
                "--remove_unused_columns", "false",
                // "--task_embedding_dim", "128"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7",
                // "CUDA_VISIBLE_DEVICES": "0,1,2,3",
                "RANK": "0",  // 指定当前进程的 RANK 值
                // "WORLD_SIZE": "8", // 指定分布式环境中的进程总数
                "WORLD_SIZE": "8", // 指定分布式环境中的进程总数
                "MASTER_PORT": "23456",
                // "TORCH_DISTRIBUTED_DEBUG": "DETAIL",
                // "WANDB_DISABLED": "true"
            },
            "justMyCode": false
        },
        {
            "name": "Python: Distributed Prediction",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/anaconda3/envs/moelora/lib/python3.9/site-packages/torch/distributed/launch.py",
            "console": "integratedTerminal",
            "args": [
                // "--nproc_per_node=4",
                // "--master_port=23456",  // 确保端口号未被占用
                "/root/lhy/MOELoRA-peft/run_mlora.py",
                "arg_ds_predict.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7",
                // "CUDA_VISIBLE_DEVICES": "0,1",
                "RANK": "0",  // 指定当前进程的 RANK 值
                "WORLD_SIZE": "8", // 指定分布式环境中的进程总数
                "MASTER_PORT": "23456",
                // "TORCH_DISTRIBUTED_DEBUG": "DETAIL",
                "WANDB_DISABLED": "true"
            },
            "justMyCode": false
        },


        // {
        //     "name": "Python: DeepSpeed",
        //     "type": "debugpy",
        //     // "python": "/root/anaconda3/envs/moelora/bin/python3.9",
        //     "request": "launch",
        //     // "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
        //     "program": "/root/anaconda3/envs/moelora/bin/deepspeed",
        //     "console": "integratedTerminal",
        //     "args": [
        //         "/root/lhy/MOELoRA-peft/run_mlora.py",
        //         "--deepspeed", "src/ds.config",
        //         "--do_train",
        //         "--train_file", "datasets/train.json",
        //         "--cache_dir", "datasets",
        //         "--prompt_column", "input",
        //         "--response_column", "target",
        //         "--overwrite_cache",
        //         "--model_name_or_path", "resources/bloom-1b4-zh",
        //         "--output_dir", "saved/moelora",
        //         "--overwrite_output_dir",
        //         "--max_source_length", "1024",
        //         "--max_target_length", "196",
        //         "--per_device_train_batch_size", "4",
        //         "--per_device_eval_batch_size", "4",
        //         "--gradient_accumulation_steps", "2",
        //         "--max_steps", "5",
        //         "--logging_steps", "1",
        //         "--save_steps", "5",
        //         "--learning_rate", "0.0002",
        //         "--lora_rank", "16",
        //         "--trainable", "query_key_value,dense_h_to_4h,dense_4h_to_h",
        //         "--modules_to_save", "null",
        //         "--lora_dropout", "0.1",
        //         "--fp16",
        //         "--lora_name", "moelora",
        //         "--expert_num", "8"
        //     ],
        //     "env": {
        //         "MASTER_PORT": "23456", // 示例端口号，根据需要更改
        //         "RANK": "0",  // 指定当前进程的 RANK 值
        //         "WORLD_SIZE": "4", // 指定分布式环境中的进程总数
        //         "CUDA_VISIBLE_DEVICES": "0,1,2,3",
        //         "WANDB_DISABLED": "true"
        //     }
        // },
        {
            "name": "tp_series",
            "type": "debugpy",
            "request": "launch",
            "program": "test.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "preLaunchTask": "Predict"
        },
        {
            "name": "predict",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_predict.json"
            ],
            "env": {
                // "CUDA_VISIBLE_DEVICES": "0,1,2,3",
                "CUDA_VISIBLE_DEVICES": "0",
                "WANDB_DISABLED": "true"
            },
        },
        {
            "name": "train",
            "type": "debugpy",
            // "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            // "program": "/root/anaconda3/envs/moelora/bin/accelerate",
            // "python": "/root/anaconda3/envs/moelora/bin/accelerate",
            "module": "accelerate.commands.launch",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "/root/lhy/MOELoRA-peft/run_mlora.py",
                // "arg_fun.json"
                "arg_ds_train.json"
            ],
            "env":{
                "WANDB_DISABLED": "true",
                "CUDA_VISIBLE_DEVICES": "0",
                // "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7",
                // "TORCH_DISTRIBUTED_DEBUG": "DETAIL",
            }
        },
        {
            "name": "evaluate_metric",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/results/evaluate.py",
            "console": "integratedTerminal",
            // "justMyCode": false,
        },
        {
            "name": "train_and_predict",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_traina_and_predict.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
              "--cuda_devices", "0",
              "--train_json", "arg_train.json",
              "--predict_json", "arg_predict.json"
            ]
        },
        {
            "name": "train_and_predict_gpu_0",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_traina_and_predict.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
              "--cuda_devices", "0",
              "--train_json", "arg_train_gpu_3.json",
              "--predict_json", "arg_predict_gpu_3.json"
            ]
        },
        {
            "name": "train_and_predict_gpu_1",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_traina_and_predict.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
              "--cuda_devices", "0",
              "--train_json", "arg_train_gpu_3.json",
              "--predict_json", "arg_predict_gpu_3.json"
            ]
        },
        {
            "name": "train_and_predict_gpu_2",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_traina_and_predict.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
              "--cuda_devices", "0",
              "--train_json", "arg_train_gpu_3.json",
              "--predict_json", "arg_predict_gpu_3.json"
            ]
        },
        {
            "name": "train_and_predict_gpu_3",
            "type": "debugpy",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_traina_and_predict.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
              "--cuda_devices", "3",
              "--train_json", "arg_train_gpu_3.json",
              "--predict_json", "arg_predict_gpu_3.json"
            ]
        },
        {
            "name": "train_gpu0",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_train_gpu_0.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "0,1,2,3",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "train_gpu1",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_train_gpu_1.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "0,1,2,3",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "train_gpu2",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_train_gpu_2.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "2",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "train_gpu_3",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_train_gpu3.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "3",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "predict_gpu_0",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_predict_gpu_0.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "0",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "predict_gpu_0_1",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_predict_gpu_0_1.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "1",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "predict_gpu_1",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_predict_gpu_1.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "2",
                "WANDB_DISABLED": "true"
            }
        },
        {
            "name": "predict_gpu_1_1",
            "type": "debugpy",
            "python": "/root/anaconda3/envs/moelora/bin/python",
            "request": "launch",
            "program": "/root/lhy/MOELoRA-peft/run_mlora.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "arg_predict_gpu_1_1.json"
            ],
            "env": {
                "CUDA_VISIBLE_DEVICES": "3",
                "WANDB_DISABLED": "true"
            }
        },
    ]
}
